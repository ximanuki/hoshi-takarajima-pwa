# 変更仕様書 v2: Duolingo風の適応学習ループ導入

## 0. 背景と目的
現行MVPはランダム出題で、学習者の習熟度に応じた難易度制御がない。
このままだと「簡単すぎる」「難しすぎる」が混在し、継続率が下がる。

本変更の目的は、以下3点。
1. 子どもが「ちょうどよい難しさ」を維持できること
2. 間違えた内容を短周期で復習できること
3. 進歩（レベル上昇）が見えること

## 1. 初期提案（正）: Duolingo風の最小実装

### 1.1 学習アルゴリズム（MVP+）
- 出題単位を「問題」から「スキル」に拡張する
  - 例: `add_within10`, `hiragana_order`
- 各問題に `difficulty(1..5)` を付与
- 各スキルに学習状態を保存
  - `mastery(0..100)`
  - `streak`（連続正解）
  - `nextReviewAt`（次回復習時刻）
  - `seenCount`

### 1.2 ミッション編成（5問）
- Review枠（最大2問）: 復習期限が来たスキルを優先
- Core枠（2〜3問）: 現在レベル近傍（target±1）
- Challenge枠（最大1問）: target+1 の挑戦問題

### 1.3 難易度制御（subjectごと）
- `targetDifficulty` を教科ごとに持つ（初期1）
- ミッション終了時に更新
  - 正答率が高く、平均習熟度が十分なら +1
  - 正答率が低いなら -1
  - 1..5にクランプ

### 1.4 復習ロジック（軽量SRS）
- 正解: `streak`増、復習間隔を拡大（5分→30分→2時間→8時間→1日→3日）
- 不正解: `streak`を0、3分後に再復習

### 1.5 UI/UX最小反映
- ミッション選択画面に「おすすめレベル」「復習件数」を表示
- 結果画面に「レベル変化」「モード（learn/review/challenge）」を表示

## 2. クリティカルシンキング（反）

### 2.1 リスクA: 難しすぎる適応で学習意欲が落ちる
- 問題: 1回好成績で即昇格すると、小1〜2には急すぎる
- 対策: 昇格条件に「平均習熟度ゲート」を追加

### 2.2 リスクB: 問題バンク不足で同じ問題が多発
- 問題: 出題の多様性不足で飽きる
- 対策: スキルごとに難易度帯を分散し、優先順位で再利用を制御

### 2.3 リスクC: 複雑化しすぎると保守が難しい
- 問題: 完全Duolingo再現はMVPには過剰
- 対策: まずは「適応出題 + 軽量SRS + レベル可視化」に限定

### 2.4 リスクD: 低年齢向けUXを損なう
- 問題: 数値だらけで学習感が強くなる
- 対策: 内部ロジックは高度化しつつUIは短文・やさしい表現を維持

## 3. アウフヘーベン（統合結論）

### 3.1 採用方針
- 「完全Duolingoコピー」は行わない
- 代わりに、教育効果と実装現実性のバランスが良い
  **Adaptive Mission Engine v1** を採用する

### 3.2 実装スコープ（今回）
1. 問題データの拡張（skillId/difficulty）
2. 適応ミッション生成（review/core/challenge）
3. 学習状態更新（mastery/SRS/targetDifficulty）
4. UI最小反映（ミッション画面・結果画面）
5. 既存報酬系との整合（XP/スター）

### 3.3 今回見送るもの
- ハート制（ライフ制）
- 完全パス構造（ユニット/章）
- サーバ同期型の高度分析

## 4. 受け入れ基準
- 同一教科を連続実行すると、targetDifficultyが成績に応じて変動する
- 間違えたスキルが次ミッションで優先的に再出題される
- 結果画面で難易度変化が確認できる
- 既存機能（ストリーク、バッジ、保護者画面）が壊れない

## 5. ロールバック容易性
- 主要変更は `src/utils/mission.ts` と `src/store/useAppStore.ts` に集中
- 問題データ拡張は後方互換を壊さない項目追加

